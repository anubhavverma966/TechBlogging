<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TechBlogging</title>

    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Custom CSS -->
    <style>
        .banner-background {
            background-color: #7e57c2;
            clip-path: polygon(0 0, 100% 0, 100% 97%, 67% 100%, 33% 98%, 0 100%);
            padding-bottom: 60px;
        }

        .primary-color {
            background-color: #7e57c2 !important;
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            border-top-left-radius: 10px !important;
            border-top-right-radius: 10px !important;
            padding: 1.5rem 1rem;
        }

        .card-header span.fa {
            font-size: 3rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .form-text {
            font-size: 0.7rem;
            color: rgba(0, 0, 0, 0.45) !important;
            margin-top: 0.25rem;
        }

        textarea {
            resize: none;
        }

        #loader {
            display: none;
        }

        .btn-primary {
            background-color: #007bff;
            border: none;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        @media (min-width: 992px) {
            .register-card {
                max-width: 450px;
            }
        }
    </style>
</head>
<body>
	
	<!-- Navbar -->
	<div th:insert="~{fragments/navbar :: main-navbar}"></div>

	<main class="primary-color banner-background">
	    <div class="container">
	        <div class="row justify-content-center">
	            <div class="col-md-6 col-lg-5 register-card">
	                <div class="card">
	                    <div class="card-header text-center primary-color text-white">
	                        <span class="fa fa-user-circle fa-3x"></span>
	                        <p class="mb-0">Register Here</p>
	                    </div>
	                    <div class="card-body">
	                        <form id="reg-form" action="#" th:action="@{/register}" th:object="${user}" method="POST">
	
	                            <!-- Username -->
	                            <div class="mb-3">
	                                <label for="user_name" class="form-label">User Name</label>
	                                <input type="text" th:field="*{name}" class="form-control" id="user_name"
	                                       placeholder="Enter name" required>
	                            </div>
	
	                            <!-- Email -->
	                            <div class="mb-3">
	                                <label for="exampleInputEmail1" class="form-label">Email address</label>
	                                <input type="email" th:field="*{email}" class="form-control" id="exampleInputEmail1"
	                                       placeholder="Enter email" required>
	                                <div id="emailHelp" class="form-text">
	                                    We'll never share your email with anyone else.
	                                </div>
	                            </div>
	
	                            <!-- Password -->
	                            <div class="mb-3">
	                                <label for="exampleInputPassword1" class="form-label">Password</label>
	                                <input type="password" th:field="*{password}" class="form-control"
	                                       id="exampleInputPassword1" placeholder="Password" required>
	                            </div>
	
	                            <!-- Gender -->
	                            <div class="mb-3">
	                                <label class="form-label d-block">Select Gender</label>
	                                <div class="form-check form-check-inline">
	                                    <input class="form-check-input" type="radio" th:field="*{gender}" id="genderMale" th:value="male" required>
	                                    <label class="form-check-label" for="genderMale">Male</label>
	                                </div>
	                                <div class="form-check form-check-inline">
	                                    <input class="form-check-input" type="radio" th:field="*{gender}" id="genderFemale" th:value="female">
	                                    <label class="form-check-label" for="genderFemale">Female</label>
	                                </div>
	                                <div class="form-check form-check-inline">
	                                    <input class="form-check-input" type="radio" th:field="*{gender}" id="genderOther" th:value="other">
	                                    <label class="form-check-label" for="genderOther">Other</label>
	                                </div>
	                            </div>
	
	                            <!-- About -->
	                            <div class="mb-3">
	                                <label for="about" class="form-label">About</label>
	                                <textarea th:field="*{about}" class="form-control" id="about" rows="4"
	                                          placeholder="Enter something about yourself"></textarea>
	                            </div>
	                            
	                            <div class="mb-3">
			                        <label for="profilePic" class="form-label">Select Your Profile Pic</label>
			                        <input name="profile_pic" type="file" class="form-control">
			                    </div>
	
	                            <!-- Terms and Conditions -->
	                            <div class="mb-3 form-check">
	                                <input name="check" type="checkbox" class="form-check-input" id="exampleCheck1">
	                                <label class="form-check-label" for="exampleCheck1">
	                                    Agree Terms and Conditions
	                                </label>
	                            </div>
	
	                            <!-- Loader -->
	                            <div class="text-center" id="loader">
	                                <span class="fa fa-refresh fa-4x fa-spin"></span>
	                                <h5>Please Wait...</h5>
	                            </div>
	                            
	                            	
	                            <!-- Submit Button -->
	                            <div>
	                                <button id="submit-btn" type="submit" class="btn btn-primary px-5">Signup</button>
	                            </div>
	
	                        </form>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	</main>
	
	
	<!-- Bootstrap 5 JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
	<script>
		
		document.addEventListener("DOMContentLoaded", () => {
		    console.log("Register page loaded");
		
		    const regForm = document.getElementById("reg-form");
		    const submitBtn = document.getElementById("submit-btn");
		    const loader = document.getElementById("loader");
		
		    regForm.addEventListener("submit", async (event) => {
		        event.preventDefault();
		
		        // Prepare form data
		        const formData = new FormData(regForm);
		
		        // Toggle loading UI
		        submitBtn.style.display = "none";
		        loader.style.display = "block";
		
		        try {
		            const response = await fetch("/register", {
		                method: "POST",
		                body: formData
		            });
		
		            const data = await response.text();
		            console.log("Server response:", data);
		
		            // Reset button and loader visibility
		            submitBtn.style.display = "inline-block";
		            loader.style.display = "none";
		
		            // Match old servlet logic responses
		            if (data.trim() === "done") {
		                swal("Registered Successfully. Redirecting to login page...")
		                    .then(() => {
		                        window.location.href = "/loginPage";
		                    });
		            } else {
		                swal(data);
		            }
		
		        } catch (error) {
		            console.error("Error:", error);
		            submitBtn.style.display = "inline-block";
		            loader.style.display = "none";
		            swal("Something went wrong. Try Again...");
		        }
		    });
		});
	</script>


</body>
</html>